# TASK-501: E2Eテストケース設計

## テストケース概要

**総テストケース数**: 85
**カテゴリ数**: 12
**実行時間目標**: 20分以内

## 1. 認証フローテスト (8ケース)

### 1.1 ユーザー登録フロー (3ケース)
- **TC-001**: 新規ユーザー登録成功フロー
  - 有効メール・表示名・パスワードで登録
  - 確認メール送信確認
  - 登録完了後のリダイレクト確認
- **TC-002**: 無効データでの登録失敗
  - 重複メールアドレス・弱いパスワード・無効フォーマット
  - エラーメッセージ表示確認
- **TC-003**: 利用規約未同意での登録失敗
  - チェックボックス未選択での送信ブロック

### 1.2 ログインフロー (3ケース)
- **TC-004**: 有効認証情報でのログイン成功
  - メール・パスワード入力
  - ログイン状態保持確認
  - ダッシュボードリダイレクト
- **TC-005**: 無効認証情報でのログイン失敗
  - 間違ったパスワード・存在しないメール
  - エラーメッセージ表示確認
- **TC-006**: ログイン状態永続化
  - ブラウザリフレッシュ後のログイン状態維持

### 1.3 パスワードリセットフロー (2ケース)
- **TC-007**: パスワードリセット成功フロー
  - メールアドレス入力・送信
  - 成功メッセージ表示確認
- **TC-008**: 存在しないメールでのリセット失敗
  - エラーメッセージ表示確認

## 2. ガチャフローテスト (15ケース)

### 2.1 ガチャ閲覧・検索 (4ケース)
- **TC-009**: ガチャ一覧表示・ページネーション
- **TC-010**: ガチャ検索機能 (VTuber名・価格フィルター)
- **TC-011**: ガチャ詳細画面表示
- **TC-012**: 排出率テーブル表示確認

### 2.2 ガチャ購入・抽選 (6ケース)
- **TC-013**: メダル残高充分時の単発抽選成功
- **TC-014**: メダル残高充分時の10連抽選成功
- **TC-015**: メダル残高不足時の購入失敗
- **TC-016**: 抽選アニメーション・結果表示確認
- **TC-017**: レアリティ別結果表示確認
- **TC-018**: 抽選後のメダル残高更新確認

### 2.3 ガチャ履歴・統計 (5ケース)
- **TC-019**: 抽選履歴一覧表示
- **TC-020**: 統計情報表示 (回数・金額・レアリティ別)
- **TC-021**: 履歴フィルタリング (期間・VTuber・レアリティ)
- **TC-022**: 履歴詳細表示
- **TC-023**: 統計エクスポート機能

## 3. 推しメダル・交換所フローテスト (12ケース)

### 3.1 メダル残高管理 (3ケース)
- **TC-024**: メダル残高表示・更新確認
- **TC-025**: VTuber別メダル分布表示
- **TC-026**: メダル使用履歴表示

### 3.2 交換所フロー (6ケース)
- **TC-027**: 交換アイテム一覧表示・検索
- **TC-028**: アイテム詳細表示・在庫確認
- **TC-029**: メダル充分時の交換成功
- **TC-030**: メダル不足時の交換失敗
- **TC-031**: 交換上限達成時のブロック
- **TC-032**: 期間外交換のブロック

### 3.3 交換履歴 (3ケース)
- **TC-033**: 交換履歴一覧・フィルタリング
- **TC-034**: 交換詳細情報表示
- **TC-035**: 履歴エクスポート機能

## 4. 特典BOXフローテスト (10ケース)

### 4.1 特典閲覧・検索 (3ケース)
- **TC-036**: 特典一覧表示・カテゴリフィルター
- **TC-037**: 特典検索機能 (ファイル名・タグ)
- **TC-038**: 特典詳細・プレビュー表示

### 4.2 ダウンロード機能 (4ケース)
- **TC-039**: 単体ファイルダウンロード成功
- **TC-040**: 一括ダウンロード成功 (ZIP形式)
- **TC-041**: ダウンロード進捗表示確認
- **TC-042**: ダウンロード失敗時のエラー表示

### 4.3 特典管理 (3ケース)
- **TC-043**: ダウンロード履歴表示・フィルター
- **TC-044**: 特典整理機能 (既読・未読管理)
- **TC-045**: 特典共有機能 (URL生成)

## 5. VTuber管理フローテスト (15ケース)

### 5.1 VTuber申請フロー (4ケース)
- **TC-046**: VTuber申請フォーム送信成功
- **TC-047**: 申請ファイルアップロード確認
- **TC-048**: 申請ステータス確認・更新通知
- **TC-049**: 申請内容修正・再送信

### 5.2 ガチャ作成・管理 (5ケース)
- **TC-050**: ガチャ作成フォーム・排出率設定
- **TC-051**: ガチャ公開・非公開切替
- **TC-052**: ガチャ編集・削除機能
- **TC-053**: ガチャプレビュー・テスト抽選
- **TC-054**: ガチャ統計・分析表示

### 5.3 ダッシュボード・分析 (6ケース)
- **TC-055**: 売上統計表示・期間フィルター
- **TC-056**: ユーザー統計・成長トレンド
- **TC-057**: 人気コンテンツランキング
- **TC-058**: 収益分析・予測表示
- **TC-059**: レポートエクスポート (PDF・Excel)
- **TC-060**: リアルタイム通知・アラート

## 6. 管理者フローテスト (12ケース)

### 6.1 管理者認証・ダッシュボード (3ケース)
- **TC-061**: 管理者ログイン・権限確認
- **TC-062**: システム全体ダッシュボード表示
- **TC-063**: システムアラート・メトリクス表示

### 6.2 VTuber審査フロー (4ケース)
- **TC-064**: VTuber申請一覧・検索・フィルター
- **TC-065**: 申請詳細確認・承認フロー
- **TC-066**: 申請却下・理由入力
- **TC-067**: 追加情報要求・申請者通知

### 6.3 ユーザー管理 (3ケース)
- **TC-068**: ユーザー一覧・検索・ステータス管理
- **TC-069**: ユーザー詳細・アクション履歴確認
- **TC-070**: ユーザー停止・復帰操作

### 6.4 システム監視 (2ケース)
- **TC-071**: システムメトリクス・パフォーマンス監視
- **TC-072**: エラーログ・アラート管理

## 7. パフォーマンステスト (6ケース)

### 7.1 ページロード性能 (3ケース)
- **TC-073**: ホームページロード時間 (3秒以内)
- **TC-074**: ガチャ一覧ページロード (3秒以内)
- **TC-075**: 管理者ダッシュボードロード (5秒以内)

### 7.2 機能別性能 (3ケース)
- **TC-076**: ガチャ抽選実行時間 (3秒以内)
- **TC-077**: ファイルダウンロード時間 (5秒以内)
- **TC-078**: API レスポンス時間 (1秒以内)

## 8. モバイル・レスポンシブテスト (8ケース)

### 8.1 モバイル対応 (4ケース)
- **TC-079**: スマートフォン (375px) での操作性
- **TC-080**: タブレット (768px) での表示・操作
- **TC-081**: タッチジェスチャー対応確認
- **TC-082**: 縦・横画面切替対応

### 8.2 クロスブラウザ (4ケース)
- **TC-083**: Chrome・Firefox・Safari動作確認
- **TC-084**: iOS Safari・Android Chrome動作
- **TC-085**: 古いブラウザでの graceful degradation
- **TC-086**: 各ブラウザでの UI 一貫性確認

## 9. エラーシナリオテスト (10ケース)

### 9.1 ネットワークエラー (4ケース)
- **TC-087**: オフライン状態での操作・エラー表示
- **TC-088**: 接続タイムアウト時の処理
- **TC-089**: 間欠的ネットワークエラーでの回復
- **TC-090**: 大容量ファイル処理時の安定性

### 9.2 認証・権限エラー (3ケース)
- **TC-091**: セッション期限切れ時の処理
- **TC-092**: 権限不足時のアクセス制御
- **TC-093**: 不正アクセス試行時のブロック

### 9.3 データエラー (3ケース)
- **TC-094**: サーバーエラー (500) 時の表示
- **TC-095**: リソース未発見 (404) 時の処理
- **TC-096**: データ整合性エラー時の処理

## 10. アクセシビリティテスト (5ケース)

### 10.1 スクリーンリーダー対応 (3ケース)
- **TC-097**: 主要画面のスクリーンリーダー読み上げ
- **TC-098**: フォーム要素のラベル・説明
- **TC-099**: エラーメッセージの適切な通知

### 10.2 キーボード操作 (2ケース)
- **TC-100**: タブキーでのフォーカス移動
- **TC-101**: キーボードショートカット動作

## 11. セキュリティテスト (4ケース)

### 11.1 入力値検証 (2ケース)
- **TC-102**: XSS攻撃耐性確認
- **TC-103**: SQLインジェクション対策確認

### 11.2 認証セキュリティ (2ケース)
- **TC-104**: JWT トークン改ざん耐性
- **TC-105**: CSRF攻撃対策確認

## 12. 統合フローテスト (7ケース)

### 12.1 エンドツーエンドシナリオ (4ケース)
- **TC-106**: 新規ユーザー完全フロー (登録→ガチャ→交換→特典)
- **TC-107**: VTuber完全フロー (申請→承認→ガチャ作成→収益確認)
- **TC-108**: 管理者完全フロー (ログイン→審査→システム管理)
- **TC-109**: 複数ユーザー同時操作テスト

### 12.2 データ整合性 (3ケース)
- **TC-110**: ガチャ購入→メダル減少の整合性
- **TC-111**: 交換処理→在庫減少の整合性
- **TC-112**: VTuber収益→システム統計の整合性

## テスト実行戦略

### 並列実行グループ

#### グループA: 基本フロー (並列実行)
- 認証フロー (TC-001〜008)
- ガチャフロー (TC-009〜023)
- 交換所フロー (TC-024〜035)

#### グループB: 管理機能 (並列実行)
- 特典BOXフロー (TC-036〜045)
- VTuber管理フロー (TC-046〜060)
- 管理者フロー (TC-061〜072)

#### グループC: 品質・性能 (シーケンシャル実行)
- パフォーマンステスト (TC-073〜078)
- モバイル・クロスブラウザ (TC-079〜086)
- エラーシナリオ (TC-087〜096)

#### グループD: 専門テスト (シーケンシャル実行)
- アクセシビリティ (TC-097〜101)
- セキュリティ (TC-102〜105)
- 統合フロー (TC-106〜112)

### 実行順序
```
1. グループA・B (並列実行): 35分
2. グループC (シーケンシャル): 20分
3. グループD (シーケンシャル): 15分
total: 約70分 (但し並列化により実際は25分程度)
```

## テストデータ設計

### ユーザーデータ
```typescript
const testUsers = {
  normalUser: {
    email: 'test@koepon.com',
    password: 'TestPass123!',
    displayName: 'テストユーザー',
    medalBalance: 1000
  },
  vtuberUser: {
    email: 'vtuber@koepon.com', 
    password: 'VTuberPass123!',
    displayName: 'テストVTuber',
    status: 'approved'
  },
  adminUser: {
    email: 'admin@koepon.com',
    password: 'AdminPass123!',
    role: 'admin'
  }
}
```

### ガチャデータ
```typescript
const testGachas = {
  basicGacha: {
    id: 'gacha-001',
    name: 'テストガチャ',
    price: 100,
    vtuberId: 'vtuber-001',
    items: [
      { name: 'コモン', rarity: 'common', rate: 80 },
      { name: 'レア', rarity: 'rare', rate: 15 },
      { name: 'SSR', rarity: 'ssr', rate: 5 }
    ]
  },
  expensiveGacha: {
    id: 'gacha-002', 
    name: '高額ガチャ',
    price: 500,
    vtuberId: 'vtuber-001'
  }
}
```

## 期待する成果

### テスト網羅性
- **機能カバレッジ**: 主要機能100%
- **エラーシナリオ**: 95%以上
- **ブラウザ対応**: 95%以上の成功率

### 品質指標
- **実行時間**: 25分以内
- **成功率**: 95%以上
- **フレーク率**: 2%以下

### CI連携
- **自動実行**: プルリクエスト・マージ時
- **レポート**: HTML・JSON・JUnit形式
- **失敗時**: スクリーンショット・動画自動保存

このテストケース設計により、こえポン！アプリケーションの品質とユーザー体験を包括的に検証します。